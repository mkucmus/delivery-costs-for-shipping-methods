<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>
        <!-- Shipping costs calculator service -->
        <service id="Custom\CartExtension\Service\AllShippingCostsCalculator">
            <argument type="service" id="Shopware\Core\Checkout\Shipping\SalesChannel\ShippingMethodRoute"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\Delivery\DeliveryBuilder"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\Delivery\DeliveryCalculator"/>
            <argument type="service" id="Shopware\Core\Framework\Rule\RuleIdMatcher"/>
        </service>

        <!-- Cart load route decorator -->
        <service id="Custom\CartExtension\Decorator\CartLoadRouteDecorator"
                 decorates="Shopware\Core\Checkout\Cart\SalesChannel\CartLoadRoute">
            <argument type="service" id="Custom\CartExtension\Decorator\CartLoadRouteDecorator.inner"/>
            <argument type="service" id="Custom\CartExtension\Service\AllShippingCostsCalculator"/>
        </service>

        <!-- Shipping methods with costs route -->
        <service id="Custom\CartExtension\Route\ShippingMethodsWithCostsRoute" public="true">
            <argument type="service" id="Custom\CartExtension\Service\AllShippingCostsCalculator"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\AbstractCartPersister"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\CartFactory"/>
            <argument type="service" id="Shopware\Core\Checkout\Cart\CartCalculator"/>
            <tag name="controller.service_arguments"/>
        </service>
    </services>
</container>
